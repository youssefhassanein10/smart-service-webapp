<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, select, button { margin: 5px 0; padding: 5px; }
    .container { max-width: 600px; margin: auto; }
    .category, .product { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    img { max-width: 100px; display: block; margin-top: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Admin Panel</h2>

    <h3>Add Category</h3>
    <input type="text" id="categoryName" placeholder="Category Name">
    <button id="addCategoryBtn">Add Category</button>

    <h3>Categories</h3>
    <div id="categoriesList"></div>

    <h3>Add Product</h3>
    <input type="text" id="productName" placeholder="Product Name"><br>
    <select id="productCategory"></select><br>
    <input type="number" id="productPrice" placeholder="Price"><br>
    <input type="file" id="productImage"><br>
    <button id="addProductBtn">Add Product</button>

    <h3>Products</h3>
    <div id="productsList"></div>
  </div>

  <script>
    async function fetchData() {
      const res = await fetch('/api/data');
      const data = await res.json();
      return data;
    }

    async function updateCategories() {
      const data = await fetchData();
      const categoriesDiv = document.getElementById('categoriesList');
      const categorySelect = document.getElementById('productCategory');
      categoriesDiv.innerHTML = '';
      categorySelect.innerHTML = '';

      data.categories.forEach(cat => {
        const div = document.createElement('div');
        div.className = 'category';
        div.textContent = cat.name;
        categoriesDiv.appendChild(div);

        const option = document.createElement('option');
        option.value = cat.id;
        option.textContent = cat.name;
        categorySelect.appendChild(option);
      });
    }

    async function updateProducts() {
      const data = await fetchData();
      const productsDiv = document.getElementById('productsList');
      productsDiv.innerHTML = '';

      data.products.forEach(prod => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `<strong>${prod.name}</strong> - $${prod.price}<br>
                         Category ID: ${prod.categoryId}`;
        if (prod.image) {
          const img = document.createElement('img');
          img.src = `/uploads/${prod.image}`;
          div.appendChild(img);
        }
        productsDiv.appendChild(div);
      });
    }

    document.getElementById('addCategoryBtn').addEventListener('click', async () => {
      const name = document.getElementById('categoryName').value;
      if (!name) return alert('Enter category name');

      const res = await fetch('/api/add-category', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById('categoryName').value = '';
        updateCategories();
      }
    });

    document.getElementById('addProductBtn').addEventListener('click', async () => {
      const name = document.getElementById('productName').value;
      const categoryId = document.getElementById('productCategory').value;
      const price = document.getElementById('productPrice').value;
      const imageFile = document.getElementById('productImage').files[0];

      if (!name || !categoryId || !price) return alert('Fill all fields');

      const formData = new FormData();
      formData.append('name', name);
      formData.append('categoryId', categoryId);
      formData.append('price', price);
      if (imageFile) formData.append('image', imageFile);

      const res = await fetch('/api/add-product', {
        method: 'POST',
        body: formData
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        document.getElementById('productImage').value = '';
        updateProducts();
      }
    });

    // Инициализация
    updateCategories();
    updateProducts();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, select, button { margin: 5px 0; padding: 5px; }
    .container { max-width: 600px; margin: auto; }
    .category, .product { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    img { max-width: 100px; display: block; margin-top: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Admin Panel</h2>

    <h3>Add Category</h3>
    <input type="text" id="categoryName" placeholder="Category Name">
    <button id="addCategoryBtn">Add Category</button>

    <h3>Categories</h3>
    <div id="categoriesList"></div>

    <h3>Add Product</h3>
    <input type="text" id="productName" placeholder="Product Name"><br>
    <select id="productCategory"></select><br>
    <input type="number" id="productPrice" placeholder="Price"><br>
    <input type="file" id="productImage"><br>
    <button id="addProductBtn">Add Product</button>

    <h3>Products</h3>
    <div id="productsList"></div>
  </div>

  <script>
    async function fetchData() {
      const res = await fetch('/api/data');
      const data = await res.json();
      return data;
    }

    async function updateCategories() {
      const data = await fetchData();
      const categoriesDiv = document.getElementById('categoriesList');
      const categorySelect = document.getElementById('productCategory');
      categoriesDiv.innerHTML = '';
      categorySelect.innerHTML = '';

      data.categories.forEach(cat => {
        const div = document.createElement('div');
        div.className = 'category';
        div.textContent = cat.name;
        categoriesDiv.appendChild(div);

        const option = document.createElement('option');
        option.value = cat.id;
        option.textContent = cat.name;
        categorySelect.appendChild(option);
      });
    }

    async function updateProducts() {
      const data = await fetchData();
      const productsDiv = document.getElementById('productsList');
      productsDiv.innerHTML = '';

      data.products.forEach(prod => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `<strong>${prod.name}</strong> - $${prod.price}<br>
                         Category ID: ${prod.categoryId}`;
        if (prod.image) {
          const img = document.createElement('img');
          img.src = `/uploads/${prod.image}`;
          div.appendChild(img);
        }
        productsDiv.appendChild(div);
      });
    }

    document.getElementById('addCategoryBtn').addEventListener('click', async () => {
      const name = document.getElementById('categoryName').value;
      if (!name) return alert('Enter category name');

      const res = await fetch('/api/add-category', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById('categoryName').value = '';
        updateCategories();
      }
    });

    document.getElementById('addProductBtn').addEventListener('click', async () => {
      const name = document.getElementById('productName').value;
      const categoryId = document.getElementById('productCategory').value;
      const price = document.getElementById('productPrice').value;
      const imageFile = document.getElementById('productImage').files[0];

      if (!name || !categoryId || !price) return alert('Fill all fields');

      const formData = new FormData();
      formData.append('name', name);
      formData.append('categoryId', categoryId);
      formData.append('price', price);
      if (imageFile) formData.append('image', imageFile);

      const res = await fetch('/api/add-product', {
        method: 'POST',
        body: formData
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        document.getElementById('productImage').value = '';
        updateProducts();
      }
    });

    // Инициализация
    updateCategories();
    updateProducts();
  </script>
</body>
</html>
