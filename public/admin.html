<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Админка</title>
<style>
body { font-family: Arial; padding: 20px; }
input, select, button { margin: 5px 0; }
img { max-width: 100px; display: block; margin-top: 5px; }
</style>
</head>
<body>

<h2>Категории</h2>
<input type="text" id="categoryName" placeholder="Название категории">
<button id="addCategory">Добавить категорию</button>
<ul id="categoryList"></ul>

<h2>Товары</h2>
<input type="text" id="productTitle" placeholder="Название">
<input type="text" id="productDescription" placeholder="Описание">
<input type="number" id="productPrice" placeholder="Цена">
<select id="productCategory"></select>
<input type="file" id="productImage">
<button id="addProduct">Добавить товар</button>
<ul id="productList"></ul>

<script>
const token = 'SUPER_SECRET_TOKEN';

async function loadCategories() {
  const res = await fetch('/api/categories');
  const categories = await res.json();
  const list = document.getElementById('categoryList');
  const select = document.getElementById('productCategory');
  list.innerHTML = '';
  select.innerHTML = '';
  categories.forEach(c => {
    const li = document.createElement('li'); li.textContent = c.name; list.appendChild(li);
    const opt = document.createElement('option'); opt.value=c.id; opt.textContent=c.name; select.appendChild(opt);
  });
}
async function loadProducts() {
  const res = await fetch('/api/products');
  const products = await res.json();
  const list = document.getElementById('productList');
  list.innerHTML = '';
  products.forEach(p => {
    const li = document.createElement('li');
    li.innerHTML = `${p.title} - ${p.description} - ${p.price} руб. ${p.image_url ? '<img src="'+p.image_url+'">' : ''}`;
    list.appendChild(li);
  });
}

document.getElementById('addCategory').onclick = async () => {
  const name = document.getElementById('categoryName').value;
  if (!name) return alert('Введите название');
  await fetch('/api/categories', {
    method:'POST',
    headers:{'Content-Type':'application/json', 'x-admin-token': token},
    body: JSON.stringify({name})
  });
  document.getElementById('categoryName').value='';
  loadCategories();
}

document.getElementById('addProduct').onclick = async () => {
  const title = document.getElementById('productTitle').value;
  const description = document.getElementById('productDescription').value;
  const price = document.getElementById('productPrice').value;
  const category_id = document.getElementById('productCategory').value;
  const image = document.getElementById('productImage').files[0];
  if (!title || !description || !price || !category_id) return alert('Заполните все поля');
  const form = new FormData();
  form.append('title', title);
  form.append('description', description);
  form.append('price', price);
  form.append('category_id', category_id);
  if (image) form.append('image', image);
  await fetch('/api/products', { method:'POST', headers:{'x-admin-token': token}, body: form });
  document.getElementById('productTitle').value='';
  document.getElementById('productDescription').value='';
  document.getElementById('productPrice').value='';
  document.getElementById('productImage').value='';
  loadProducts();
}

loadCategories();
loadProducts();
</script>
</body>
</html>
